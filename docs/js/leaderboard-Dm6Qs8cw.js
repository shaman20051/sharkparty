import{r as h,w as B,l as J,e as L,c as n,a as o,b as e,t,F as y,g as T,i as D,f as S,j as M,m as K,h as I,p as V,n as O,v as R,o as q,k as E,d as G}from"./script-_nmGqW4k.js";const H={class:"leaderboard-details"},Q={class:"leaderboards-grid__cell leaderboards-grid__cell--details"},W={class:"leaderboard-header"},X={class:"leaderboard-header__title"},Y={class:"leaderboard-header__period"},Z={class:"leaderboard-conditions"},ee={class:"leaderboard-conditions__text"},ae={class:"leaderboard-conditions__tournaments"},re={class:"leaderboard-conditions__list"},le={href:"#",class:"leaderboard-conditions__link"},te={class:"leaderboard-table"},se={class:"leaderboard-grid"},oe={class:"leaderboard-grid__header leaderboard-grid__row"},de={key:0},ne={key:0},ie={key:0},ce={class:"leaderboard-grid__row leaderboard-grid__row--player"},_e={class:"leaderboard-grid__cell leaderboard-grid__cell--number"},ue={class:"leaderboard-grid__cell leaderboard-grid__cell--player"},ve={class:"leaderboard-grid__cell leaderboard-grid__cell--country"},be={class:"leaderboard-grid__cell leaderboard-grid__cell--points"},me={class:"leaderboard-grid__cell leaderboard-grid__cell--details"},ge=["onClick"],pe={class:"leaderboard-grid__row leaderboard-grid__row--tournaments"},ye={class:"leaderboard-grid__cell leaderboard-grid__cell--full",colspan:"5"},he={class:"player-tournaments"},ke={class:"player-tournaments__cell player-tournaments__cell--number"},fe={class:"player-tournaments__cell player-tournaments__cell--name"},we={href:"#",class:"player-tournaments__link"},$e={class:"player-tournaments__cell player-tournaments__cell--place"},Pe={class:"player-tournaments__cell player-tournaments__cell--prize"},Ce={class:"player-tournaments__cell player-tournaments__cell--points"},Te={class:"pagination"},Ne={key:0,class:"pagination__link"},xe=["onClick"],Le={class:"pagination-controls"},De={__name:"Leaderboard",props:{leaderboard:Object},setup(m){const k=m,s=h(1),i=h(10),d=h("totalPoints"),u=h(!1);function v(l){return new Date(l).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}const b=h([]);B(()=>k.leaderboard.players,l=>{const r=[...l||[]].sort((a,c)=>c.totalPoints-a.totalPoints).map((a,c)=>J({...a,rank:c+1,show:!1}));b.value=r},{immediate:!0});const w=L(()=>[...b.value].sort((r,a)=>{const c=typeof r[d.value]=="string"?r[d.value].toLowerCase():r[d.value],g=typeof a[d.value]=="string"?a[d.value].toLowerCase():a[d.value];return c<g?u.value?-1:1:c>g?u.value?1:-1:0})),f=L(()=>{const l=(s.value-1)*i.value;return w.value.slice(l,l+i.value)}),$=L(()=>Math.ceil(w.value.length/i.value)),F=L(()=>{const l=[];for(let a=1;a<=$.value;a++)a===1||a===$.value||a>=s.value-2&&a<=s.value+2?l.push(a):l[l.length-1]!=="..."&&l.push("...");return l});B(i,()=>s.value=1);function z(l){typeof l=="number"&&(s.value=l)}function N(){s.value>1&&s.value--}function p(){s.value<$.value&&s.value++}function P(l){d.value===l?u.value=!u.value:(d.value=l,u.value=!0),s.value=1}function _(l){l.show=!l.show}return(l,r)=>(o(),n("div",H,[e("div",Q,[e("button",{class:"leaderboards-grid__details-link",onClick:r[0]||(r[0]=a=>l.$emit("back"))}," Список лидербордов ")]),e("div",W,[e("h2",X,'Лидерборд "'+t(m.leaderboard.leaderboardName)+'"',1),e("div",Y,t(v(m.leaderboard.startTime))+" - "+t(v(m.leaderboard.endTime)),1)]),e("div",Z,[r[6]||(r[6]=e("h3",{class:"leaderboard-conditions__title"},"Условия проведения:",-1)),e("p",ee,t(m.leaderboard.info),1),e("div",ae,[r[5]||(r[5]=e("h4",{class:"leaderboard-conditions__subtitle"},"Турниры лидерборда:",-1)),e("ul",re,[(o(!0),n(y,null,T(m.leaderboard.tournaments||[],a=>(o(),n("li",{class:"leaderboard-conditions__item",key:a.tournamentName},[e("a",le,"Турнир "+t(a.tournamentName),1)]))),128))])])]),e("div",te,[e("div",se,[e("div",oe,[r[10]||(r[10]=e("div",{class:"leaderboard-grid__cell leaderboard-grid__cell--number"},"№",-1)),e("div",{class:"leaderboard-grid__cell leaderboard-grid__cell--player sortable",onClick:r[1]||(r[1]=a=>P("nickname"))},[r[7]||(r[7]=D(" Игрок ")),d.value==="nickname"?(o(),n("span",de,t(u.value?"▲":"▼"),1)):S("",!0)]),e("div",{class:"leaderboard-grid__cell leaderboard-grid__cell--country sortable",onClick:r[2]||(r[2]=a=>P("country"))},[r[8]||(r[8]=D(" Страна ")),d.value==="country"?(o(),n("span",ne,t(u.value?"▲":"▼"),1)):S("",!0)]),e("div",{class:"leaderboard-grid__cell leaderboard-grid__cell--points sortable",onClick:r[3]||(r[3]=a=>P("totalPoints"))},[r[9]||(r[9]=D(" Очки ")),d.value==="totalPoints"?(o(),n("span",ie,t(u.value?"▲":"▼"),1)):S("",!0)]),r[11]||(r[11]=e("div",{class:"leaderboard-grid__cell leaderboard-grid__cell--details"},null,-1))]),(o(!0),n(y,null,T(f.value,a=>(o(),n(y,{key:a.nickname},[e("div",ce,[e("div",_e,t(a.rank),1),e("div",ue,t(a.nickname),1),e("div",ve,t(a.country),1),e("div",be,t(a.totalPoints.toFixed(2)),1),e("div",me,[e("button",{class:"leaderboard-grid__details-btn",onClick:c=>_(a)}," Подробнее ",8,ge)])]),M(e("div",pe,[e("div",ye,[e("div",he,[r[12]||(r[12]=I('<div class="player-tournaments__header player-tournaments__row"><div class="player-tournaments__cell player-tournaments__cell--number">№</div><div class="player-tournaments__cell player-tournaments__cell--name">Турнир</div><div class="player-tournaments__cell player-tournaments__cell--place">Место</div><div class="player-tournaments__cell player-tournaments__cell--prize">Призовые</div><div class="player-tournaments__cell player-tournaments__cell--points">Очки</div></div>',1)),(o(!0),n(y,null,T(a.tournaments,(c,g)=>(o(),n("div",{class:"player-tournaments__row",key:g},[e("div",ke,t(g+1),1),e("div",fe,[e("a",we,t(c.tournamentName),1)]),e("div",$e,t(c.place),1),e("div",Pe,t(c.prize.toFixed(2)),1),e("div",Ce,t(c.points.toFixed(2)),1)]))),128))])])],512),[[K,a.show]])],64))),128))]),e("div",Te,[e("a",{href:"#",class:"pagination__link",onClick:V(N,["prevent"])},"«"),(o(!0),n(y,null,T(F.value,a=>(o(),n(y,{key:a},[a==="..."?(o(),n("span",Ne,"...")):(o(),n("a",{key:1,href:"#",class:O(["pagination__link",{"pagination__link--active":s.value===a}]),onClick:V(c=>z(a),["prevent"])},t(a),11,xe))],64))),128)),e("a",{href:"#",class:"pagination__link",onClick:V(p,["prevent"])},"»")]),e("div",Le,[e("label",null,[r[14]||(r[14]=D(" Показывать: ")),M(e("select",{"onUpdate:modelValue":r[4]||(r[4]=a=>i.value=a)},r[13]||(r[13]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1)]),512),[[R,i.value,void 0,{number:!0}]])])])])]))}},Fe={class:"leaderboards-list"},Se={class:"leaderboards-grid"},Ve={class:"leaderboards-grid__cell leaderboards-grid__cell--number"},ze={class:"leaderboards-grid__cell leaderboards-grid__cell--name"},je={class:"leaderboards-grid__cell leaderboards-grid__cell--period"},Be={class:"leaderboards-grid__cell leaderboards-grid__cell--details"},Me=["onClick"],Ee={__name:"LeaderboardList",props:{leaderboards:Array},setup(m){return(k,s)=>(o(),n("div",Fe,[s[1]||(s[1]=e("h2",{class:"leaderboards-list__title"},"Список лидербордов",-1)),e("div",Se,[s[0]||(s[0]=I('<div class="leaderboards-grid__header leaderboards-grid__row"><div class="leaderboards-grid__cell leaderboards-grid__cell--number">№</div><div class="leaderboards-grid__cell leaderboards-grid__cell--name">Название</div><div class="leaderboards-grid__cell leaderboards-grid__cell--period">Срок проведения</div><div class="leaderboards-grid__cell leaderboards-grid__cell--details"></div></div>',1)),(o(!0),n(y,null,T(m.leaderboards,(i,d)=>(o(),n("div",{class:"leaderboards-grid__row",key:i.leaderboardName},[e("div",Ve,t(d+1),1),e("div",ze,t(i.leaderboardName),1),e("div",je,t(new Date(i.startTime).toLocaleDateString())+" - "+t(new Date(i.endTime).toLocaleDateString()),1),e("div",Be,[e("button",{class:"leaderboards-grid__details-link",onClick:u=>k.$emit("selectLeaderboard",i)}," Подробнее ",8,Me)])]))),128))])]))}},Ie={class:"leaderboards-section"},Ae={__name:"LeaderboardPage",setup(m){const k=h([]),s=h(null),i="/sharkparty/",d=async v=>{const b=await fetch(v);if(!b.ok)throw new Error(`Failed to load ${v}`);return b.json()};q(async()=>{const v=await d(`${i}data/index_leaderboard.json`),b=await Promise.all(v.map(async w=>{const f=await d(`${i}data/${w}`),$=f.indexFiles||"index_tournament.json",F=await d(`${i}data/${$}`),N=(await Promise.all(F.map(_=>d(`${i}data/${_}`)))).filter(_=>{const l=new Date(_.startTime);return l>=new Date(f.startTime)&&l<=new Date(f.endTime)&&_.info.buyIn>=1}),p={};N.forEach(_=>{const l=_.info.buyIn;_.players.forEach(r=>{const a=r.rank,c=_.prize.find(x=>{if(typeof x.place=="string"&&x.place.includes("-")){const[A,U]=x.place.split("-").map(Number);return a>=A&&a<=U}return Number(x.place)===a}),g=(c==null?void 0:c.prize)??0,j=+(g/l).toFixed(2),C=r.player.nickname;p[C]||(p[C]={nickname:C,country:r.player.country,totalPoints:0,tournaments:[]}),p[C].totalPoints+=j,p[C].tournaments.push({tournamentName:_.tournamentName,startTime:_.startTime,place:a,prize:g,points:j})})});const P=Object.values(p).sort((_,l)=>l.totalPoints-_.totalPoints);return{...f,tournaments:N,players:P}}));k.value=b});function u(v){s.value=v}return(v,b)=>(o(),n("section",Ie,[s.value?(o(),E(De,{key:1,leaderboard:s.value,onBack:b[0]||(b[0]=w=>s.value=null)},null,8,["leaderboard"])):(o(),E(Ee,{key:0,leaderboards:k.value,onSelectLeaderboard:u},null,8,["leaderboards"]))]))}};G(Ae).mount("#leaderboard-app");
